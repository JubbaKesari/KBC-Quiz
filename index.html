<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>KBC Quiz Platform – Knight Puzzle</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; margin:0; padding:20px; }
    .container { max-width:500px; margin:auto; background:#000; padding:20px; border-radius:8px; color:#fff; }
    h2 { text-align:center; margin-top:0; }
    .status-bar { display:flex; justify-content:space-between; font-family:monospace; margin-bottom:16px; }
    #chessboard {
      display:grid;
      grid-template-columns:repeat(4,60px);
      grid-template-rows:repeat(4,60px);
      gap:4px;
      justify-content:center;
    }
    .cell {
      width:60px; height:60px;
      background:#333;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; position:relative;
    }
    .cell.hidden { background:transparent; }
    .knight.white::before { content:'♘'; font-size:24px; color:#fff; }
    .knight.black::before { content:'♞'; font-size:24px; color:#fff; }
    .cell.selected { outline:3px solid yellow; }
    .controls { text-align:center; margin-top:12px; }
    button { margin:4px; padding:8px 16px; font-size:14px; }
    .feedback { text-align:center; margin-top:12px; font-weight:bold; }
    .feedback.correct { color:#0f0; }
    .feedback.wrong   { color:#f00; }
    #solutionContainer { display:none; margin-top:16px; text-align:center; }
    #solutionContainer video { width:100%; max-height:280px; background:#000; }
  </style>
</head>
<body>
  <div class="container">
    <h2>KBC Knight Puzzle</h2>
    <div class="status-bar">
      <div class="timer" id="timer"></div>
      <div class="moves" id="moves">Moves: 0</div>
    </div>
    <div id="chessboard"></div>
    <div class="controls">
      <button id="stopBtn">Stop Quiz</button>
      <button id="nextBtn" disabled>Next Quiz</button>
    </div>
    <div id="feedback" class="feedback"></div>

    <!-- Self‑hosted solution video -->
    <div id="solutionContainer">
      <p>Solution Video:</p>
      <video id="solutionVideo" controls preload="metadata">
        <source src="Knight%20Puzzle.mp4" type="video/mp4">
        Your browser doesn’t support HTML5 video.
      </video>
    </div>
  </div>

  <script>
    // Board shape mask
    const mask = [
      [0,1,0,0],
      [0,1,1,0],
      [0,1,1,1],
      [1,1,1,1]
    ];

    // **Interchanged starting positions**:
    // Black knights now start where white did
    // White knights now start where black did
    let pieces = [
      { r:0, c:1, color:'white' },  // was white
      { r:2, c:2, color:'white' },  // was white
      { r:3, c:0, color:'black' },  // was black
      { r:3, c:2, color:'black' }   // was black
    ];

    // **New win condition**: swap them back to the original spots
    const win = [
      { r:0, c:1, color:'black' },
      { r:2, c:2, color:'black' },
      { r:3, c:0, color:'white' },
      { r:3, c:2, color:'white' }
    ];

    let selected = null,
        moveCount = 0,
        timeLeft = 900,
        active = true,
        timerInterval;

    const board    = document.getElementById('chessboard'),
          timerEl  = document.getElementById('timer'),
          movesEl  = document.getElementById('moves'),
          stopBtn  = document.getElementById('stopBtn'),
          nextBtn  = document.getElementById('nextBtn'),
          feedback = document.getElementById('feedback'),
          solCont  = document.getElementById('solutionContainer');

    function start() {
      render();
      updateTimer();
      timerInterval = setInterval(() => {
        if (!active) return;
        if (timeLeft-- > 0) updateTimer();
        else clearInterval(timerInterval);
      }, 1000);
    }

    function updateTimer() {
      const m = Math.floor(timeLeft/60).toString().padStart(2,'0'),
            s = (timeLeft%60).toString().padStart(2,'0');
      timerEl.textContent = `Time: ${m}:${s}`;
    }

    function render() {
      board.innerHTML = '';
      feedback.textContent = '';
      solCont.style.display = 'none';
      nextBtn.disabled = true;
      selected = null;
      movesEl.textContent = `Moves: ${moveCount}`;

      // Build grid state
      const grid = Array(4).fill().map(()=>Array(4).fill(null));
      pieces.forEach(p => grid[p.r][p.c] = p.color);

      // Draw cells
      for (let r = 0; r < 4; r++) {
        for (let c = 0; c < 4; c++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          if (!mask[r][c]) cell.classList.add('hidden');
          cell.dataset.r = r; cell.dataset.c = c;
          if (grid[r][c]) cell.classList.add('knight', grid[r][c]);
          cell.addEventListener('click', () => onCellClick(cell, grid));
          board.appendChild(cell);
        }
      }
    }

    function onCellClick(cell, grid) {
      if (!active) return;
      const r = +cell.dataset.r, c = +cell.dataset.c;
      if (!mask[r][c]) return;

      if (!selected) {
        if (grid[r][c]) {
          selected = cell;
          cell.classList.add('selected');
        }
      } else {
        const sr = +selected.dataset.r,
              sc = +selected.dataset.c;
        if (valid(sr,sc,r,c) && !grid[r][c]) {
          const col = grid[sr][sc];
          grid[sr][sc] = null;
          grid[r][c] = col;
          pieces = pieces.filter(p => !(p.r===sr && p.c===sc));
          pieces.push({r,c,color:col});
          moveCount++;
          render();
          // Check win
          if (win.every(w => grid[w.r][w.c] === w.color)) {
            feedback.textContent = 'Correct – Goal Achieved!';
            feedback.className = 'feedback correct';
            nextBtn.disabled = false;
            active = false;
          }
        }
        selected.classList.remove('selected');
        selected = null;
      }
    }

    function valid(r1,c1,r2,c2) {
      const dr = Math.abs(r1-r2),
            dc = Math.abs(c1-c2);
      return (dr===2 && dc===1) || (dr===1 && dc===2);
    }

    stopBtn.addEventListener('click', () => {
      active = false;
      clearInterval(timerInterval);
      const grid = Array(4).fill().map(()=>Array(4).fill(null));
      pieces.forEach(p => grid[p.r][p.c] = p.color);
      if (win.every(w => grid[w.r][w.c] === w.color)) {
        feedback.textContent = 'Correct – Goal Achieved!';
        feedback.className = 'feedback correct';
      } else {
        feedback.textContent = 'Incorrect – Goal Not Achieved';
        feedback.className = 'feedback wrong';
        solCont.style.display = 'block';
      }
    });

    nextBtn.addEventListener('click', () => alert('Proceed to next quiz'));

    // Start everything
    start();
  </script>
</body>
</html>
